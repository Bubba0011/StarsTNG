@using Stars.Web.Components.Svg
@using Stars.Web.Components.Layers

<style>
	.swig {
		background-color: rgb(20,20,20);
	}
</style>

@if (Galaxy != null)
{
	<SvgBox CssClass="swig" OnClick="TargetObject" FocusOn="@focus">
		<GalaxyBoundingBox Bounds="Galaxy.Bounds" IsFilled="true" />
		<ScannerLayer Galaxy="Galaxy" />
		<GalaxyGrid Galaxy="Galaxy" />
		<GalaxyBoundingBox Bounds="Galaxy.Bounds" IsOutlined="true" />
		<PlanetLayer Galaxy="Galaxy" />

		@ChildContent
	</SvgBox>
}

@code
{
	Focus focus = new Focus() { View = Vector.Zero };

	[Parameter]
	public IGalaxy Galaxy { get; set; }

	[Parameter]
	public RenderFragment ChildContent { get; set; }

	[Parameter]
	public EventCallback<IPlanet> OnPlanetSelected { get; set; }

	private async Task TargetObject(SvgMouseEventArgs e)
	{
		var pos = new Position((int)e.SvgCoords.X, (int)e.SvgCoords.Y);
		var target = Galaxy.ClosestPlanet(pos);
		await OnPlanetSelected.InvokeAsync(target);
	}
}
