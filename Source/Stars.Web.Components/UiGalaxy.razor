@using Stars.Core
@inject IJSRuntime JSRuntime

@if (Galaxy != null)
{
	<svg width="@Galaxy.Size" height="@Galaxy.Size" style="background-color: black" @ref="SVG" @onclick="TargetObject">

		<line x1="0" x2="@Galaxy.Size" y1="@(Galaxy.Size/2)" y2="@(Galaxy.Size/2)" stroke="grey" stroke-width="1" />
		<line y1="0" y2="@Galaxy.Size" x1="@(Galaxy.Size/2)" x2="@(Galaxy.Size/2)" stroke="grey" stroke-width="1" />

		@foreach (var p in Galaxy.Planets)
		{
			<circle cx="@p.Position.X" cy="@p.Position.Y" r="1" fill="white" />
		}

		@ChildContent
	</svg>
}

@code
{
	ElementReference SVG;

	[Parameter]
	public Galaxy Galaxy { get; set; }

	[Parameter]
	public RenderFragment ChildContent { get; set; }

	[Parameter]
	public EventCallback<Planet> OnPlanetSelected { get; set; }

	private async Task TargetObject(MouseEventArgs e)
	{
		Position clickCoords = await JSRuntime.InvokeAsync<Position>("retrieveElementPosition", SVG, e);
		var target = Galaxy.ClosestPlanet(clickCoords);
		await OnPlanetSelected.InvokeAsync(target);
	}
}
