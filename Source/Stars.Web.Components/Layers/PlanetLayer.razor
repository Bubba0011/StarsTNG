@inherits LayerBase

<style>
	.planet {
		fill: rgb(20,40,40);
	}

	.planet-scanned {
		fill: rgb(40,80,80);
	}

	.planet-occupied {
		fill: rgb(240,0,0);
	}

	.planet-owned {
		fill: rgb(50,240,50);
	}

	.selected {
		stroke: gold;
		stroke-width: 0.2px;
	}

	.hab-bad {
		fill: red;
	}
	.hab-ok {
		fill: orange;
	}
	.hab-good {
		fill: yellow;
	}
	.hab-great {
		fill: green;
	}
</style>

@if (Galaxy != null && IsEnabled)
{
	@foreach (var p in Galaxy.Planets)
	{
		<circle cx="@p.Position.X" cy="@p.Position.Y" r="@GetRadiusStr(2)" class="@GetClass(p)" />

		@if (!InStdMode && p.Settlement != null)
		{
			var side = GetRadius(3);
			<rect x="@p.Position.X" y="@Str(p.Position.Y - side)" width="@Str(side)" height="@Str(side)" class="@GetStdClass(p)" />
		}
	}
}

@code
{
	private bool InStdMode => UIWrapper.RenderSettings.MainMode == UiDisplayMode.Default;

	private string GetClass(IPlanet planet)
	{
		bool isSelected = UIWrapper.Selection.IsSelected(planet);

		return (InStdMode ? GetStdClass(planet) : GetValueClass(planet)) + (isSelected ? " selected" : "");
	}

	string GetStdClass(IPlanet planet)
	{
		if (planet.Settlement != null)
		{
			return planet.Settlement.IsMine ? "planet-owned" : "planet-occupied";
		}

		if (planet.Details != null)
		{
			return "planet-scanned";
		}

		return "planet";
	}

	string GetValueClass(IPlanet planet)
	{
		var planetValue = GameWrapper.Client.Player.GetPlanetValue(planet);

		if (planetValue == null)
		{
			return "planet";
		}
		else if (planetValue <= 0)
		{
			return "hab-bad";
		}
		else if (planetValue <= 0.45)
		{
			return "hab-ok";
		}
		else if (planetValue <= 0.70)
		{
			return "hab-good";
		}
		else
		{
			return "hab-great";
		}
	}

	private string GetRadiusStr(double startValue)
	{
		var radius = GetRadius(startValue);
		return Str(radius);
	}

	private double GetRadius(double startValue)
	{
		return (startValue / Math.Pow(Zoom, 0.5));
	}

	private string Str(double value)
	{
		return Math.Round(value, 2).ToString(CultureInfo.InvariantCulture);
	}
}
